<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>fontai.io.readers API documentation</title>
<meta name="description" content="This module provides the interfaces between ML pipeline stages and storage media for the purpose of reading input files. They relay on instances …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>fontai.io.readers</code></h1>
</header>
<section id="section-intro">
<p>This module provides the interfaces between ML pipeline stages and storage media for the purpose of reading input files. They relay on instances inheriting from BytestreamPath to list and retrieve available files as bytestream, that are then deserialised to specific data formats depending on the particular reader class.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
This module provides the interfaces between ML pipeline stages and storage media for the purpose of reading input files. They relay on instances inheriting from BytestreamPath to list and retrieve available files as bytestream, that are then deserialised to specific data formats depending on the particular reader class.
&#34;&#34;&#34;

from __future__ import annotations
from pathlib import Path
import io
import zipfile
import sys
import re
import typing as t
from abc import ABC, abstractmethod
import logging

from fontai.io.storage import BytestreamPath
from fontai.io.formats import InMemoryFile, InMemoryZipfile, InMemoryFontfile
from fontai.io.scrappers import Scrapper

from tensorflow.data import TFRecordDataset

logger = logging.getLogger(__name__)

__all__ = [
  &#34;TfrReader&#34;,
  &#34;ZipReader&#34;]
  
class BatchReader(ABC):

  &#34;&#34;&#34;Interface class between ML stages and storage for file reading.
  
  Attributes:
      output_path (str): path to folder from which files are to be read
  &#34;&#34;&#34;

  def __init__(self, input_path: str):

    self.input_path = BytestreamPath(input_path)

  @abstractmethod
  def get_files(self) -&gt; t.Generator[t.Any]:
    &#34;&#34;&#34;Returns a generator for the sequence of input files
    &#34;&#34;&#34;
    pass

  def list_sources(self):
    return self.input_path.list_sources()

class TfrReader(BatchReader):

  &#34;&#34;&#34;Class that reads a sequence of Tensorflow Record files as an instance of TFRecordDataset
  &#34;&#34;&#34;

  def get_files(self):

    str_sources = [str(src) for src in self.input_path.list_sources()]

    return TFRecordDataset(filenames=str_sources)


class FileReader(BatchReader):

  &#34;&#34;&#34;Class that reads a sequence of generic files 
  &#34;&#34;&#34;

  def get_files(self):

    for src in self.input_path.list_sources():
      yield InMemoryFile(filename = str(src), content = src.read_bytes())

class ZipReader(BatchReader):

  &#34;&#34;&#34;Class that reads a sequence of zip files 
  &#34;&#34;&#34;

  def get_files(self):

    for src in self.input_path.list_sources():
      yield InMemoryZipfile(filename = str(src), content = src.read_bytes())

class FontfileReader(BatchReader):

  &#34;&#34;&#34;Class that reads a sequence of ttf/otf files 
  &#34;&#34;&#34;

  def get_files(self):

    for src in self.input_path.list_sources():
      yield InMemoryFontfile(filename = str(src), content = src.read_bytes())


class ScrapperReader(BatchReader):

  &#34;&#34;&#34;Class that reads a sequence of bytes from scrapped urls

  Attributes:
      scrappers (t.List[Scrappers]): List of Scrapper instances
  &#34;&#34;&#34;

  def __init__(self, scrappers: t.List[Scrapper]):

    self.scrappers = scrappers

  def get_files(self):

    for scrapper in self.scrappers:
      for url in scrapper.get_source_urls():
        stream = BytestreamPath(url)
        content = stream.read_bytes()
        # if any actual data can be downloaded, push as in-memory zip file
        # assume downloaded file is zip
        if sys.getsizeof(content) &gt; 0:
          yield InMemoryZipfile(filename = str(stream), content = content)



# class ReaderClassFactory(object):

#   &#34;&#34;&#34;Factory class that returns the appropriate reader depending on the expected input file format.
#   &#34;&#34;&#34;
  
#   def get(file_format: type) -&gt; type:
#     &#34;&#34;&#34;Returns a reader type for instantiation at runtime.
    
#     Args:
#         file_format (InMemoryFile): Expected input file format.
    
#     &#34;&#34;&#34;
#     if file_format == TFRecordDataset:
#       return TfrReader
#     elif file_format == InMemoryZipfile:
#       return ZipReader
#     elif file_format == InMemoryFontfile:
#       return FontfileReader
#     else:
#       logger.info(&#34;Reader class defaulted to FileReader; reading uninterpreted bytestreams.&#34;)
#       return FileReader</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="fontai.io.readers.TfrReader"><code class="flex name class">
<span>class <span class="ident">TfrReader</span></span>
<span>(</span><span>input_path: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Class that reads a sequence of Tensorflow Record files as an instance of TFRecordDataset</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class TfrReader(BatchReader):

  &#34;&#34;&#34;Class that reads a sequence of Tensorflow Record files as an instance of TFRecordDataset
  &#34;&#34;&#34;

  def get_files(self):

    str_sources = [str(src) for src in self.input_path.list_sources()]

    return TFRecordDataset(filenames=str_sources)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>fontai.io.readers.BatchReader</li>
<li>abc.ABC</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="fontai.io.readers.TfrReader.get_files"><code class="name flex">
<span>def <span class="ident">get_files</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Returns a generator for the sequence of input files</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_files(self):

  str_sources = [str(src) for src in self.input_path.list_sources()]

  return TFRecordDataset(filenames=str_sources)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="fontai.io.readers.ZipReader"><code class="flex name class">
<span>class <span class="ident">ZipReader</span></span>
<span>(</span><span>input_path: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Class that reads a sequence of zip files</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ZipReader(BatchReader):

  &#34;&#34;&#34;Class that reads a sequence of zip files 
  &#34;&#34;&#34;

  def get_files(self):

    for src in self.input_path.list_sources():
      yield InMemoryZipfile(filename = str(src), content = src.read_bytes())</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>fontai.io.readers.BatchReader</li>
<li>abc.ABC</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="fontai.io.readers.ZipReader.get_files"><code class="name flex">
<span>def <span class="ident">get_files</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Returns a generator for the sequence of input files</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_files(self):

  for src in self.input_path.list_sources():
    yield InMemoryZipfile(filename = str(src), content = src.read_bytes())</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="fontai.io" href="index.html">fontai.io</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="fontai.io.readers.TfrReader" href="#fontai.io.readers.TfrReader">TfrReader</a></code></h4>
<ul class="">
<li><code><a title="fontai.io.readers.TfrReader.get_files" href="#fontai.io.readers.TfrReader.get_files">get_files</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="fontai.io.readers.ZipReader" href="#fontai.io.readers.ZipReader">ZipReader</a></code></h4>
<ul class="">
<li><code><a title="fontai.io.readers.ZipReader.get_files" href="#fontai.io.readers.ZipReader.get_files">get_files</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>